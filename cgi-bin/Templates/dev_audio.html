<div class="flex flex-col md:flex-row gap-8 mb-8">
  <div class="md:flex-shrink-0 md:min-w-[205px] min-w-full">
    <div class="relative aspect-[1/1] sm:aspect-[1/1] lg:aspect-square  lg:shrink-0">
      <img id="cover-<TMPL_VAR file_id>" alt=""
        class="absolute inset-0 h-full w-full rounded-lg bg-gray-900 object-cover">
      <div class="absolute inset-0 rounded-2xl ring-1 ring-inset ring-gray-900/10"></div>
    </div>
  </div>
  <div class="flex-grow">
    <div class="flex justify-between">
      <div class="flex space-x-4 mt-1 items-center">
        <sapn id="play-<TMPL_VAR file_id>"
          class="text-white w-10 h-10 p-1.5 rounded-full ring-2 ring-indigo-500 bg-indigo-500 cursor-pointer">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="-1 0 24 24" stroke-width="1.5"
            stroke="currentColor" class="">
            <path stroke-linecap="round" stroke-linejoin="round"
              d="M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.348a1.125 1.125 0 010 1.971l-11.54 6.347a1.125 1.125 0 01-1.667-.985V5.653z" />
          </svg>
        </sapn>
        <div class="flex flex-col">
          <TMPL_IF is_artist_title>
            <h1 class="lg:text-md md:text-md font-semibold text-gray-100"><a href="<TMPL_VAR download_link>"
                target="_blank">
                <TMPL_VAR audio_title>
              </a></h1>
            <h3 class="lg:text-md md:text-sm font-semibold text-gray-400"><a href="<TMPL_VAR download_link>"
                target="_blank">
                <TMPL_VAR audio_artist>
              </a></h3>
            <TMPL_ELSE>
              <h1 class="lg:text-md md:text-md font-semibold text-gray-100"><a href="<TMPL_VAR download_link>"
                  target="_blank">
                  <TMPL_VAR file_title>
                </a></h1>
          </TMPL_IF>
        </div>
      </div>
      <div class="inline-flex items-center space-x-1 text-xs">
        <TMPL_IF audio_genre>
          <span
            class="inline-flex items-center gap-x-1.5 rounded-full px-2 py-1 text-xs font-medium text-gray-300 bg-slate-800 mr-2">
            <svg class="h-1.5 w-1.5 fill-indigo-400" viewBox="0 0 6 6" aria-hidden="true">
              <circle cx="3" cy="3" r="3" />
            </svg>
            <TMPL_VAR audio_genre>
          </span>
        </TMPL_IF>
        <div class="current-time-<TMPL_VAR file_id> text-gray-400 hidden">00:00</div>
        <div class="divider-<TMPL_VAR file_id> text-gray-600 hidden">/</div>
        <div class="total-time text-gray-400">
          <TMPL_VAR vid_length_txt>
        </div>
      </div>
    </div>

    <div class="mt-2 mb-1">
      <audio preload="none" id="<TMPL_VAR file_id>" type="audio/mpeg"></audio>
      <div class="controls">
        <div class="waveform-container bg-[#374151]" id="waveform-<TMPL_VAR file_id>">
          <img id="wave-<TMPL_VAR file_id>" class="w-full md:h-28 lg:h-28 ">
          <div class="progress-bar" id="progressBar-<TMPL_VAR file_id>"></div>
        </div>

      </div>
    </div>
    <div class="button">
      <div class="flex justify-between">
        <div class="inline-flex items-center space-x-2">
          <div class="inline-flex items-center space-x-2 bg-gray-800 px-3 py-2 rounded-md">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 fill-indigo-400" viewBox="0 0 384 512">
              <path
                d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z" />
            </svg>
            <span class="text-gray-300 text-xs font-medium">
              <TMPL_VAR views>
            </span>
          </div>
          <div class="inline-flex items-center space-x-2 bg-gray-800 px-3 py-2 rounded-md">

            <a href="#" onclick="return jah('/?op=vote&file_code=<TMPL_VAR file_code>&v=<TMPL_VAR vote_action>')"
              title="<TMPL_VAR vote_title>">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 fill-indigo-400" viewBox="0 0 512 512">
                <path
                  d="M47.6 300.4L228.3 469.1c7.5 7 17.4 10.9 27.7 10.9s20.2-3.9 27.7-10.9L464.4 300.4c30.4-28.3 47.6-68 47.6-109.5v-5.8c0-69.9-50.5-129.5-119.4-141C347 36.5 300.6 51.4 268 84L256 96 244 84c-32.6-32.6-79-47.5-124.6-39.9C50.5 55.6 0 115.2 0 185.1v5.8c0 41.5 17.2 81.2 47.6 109.5z">
                </path>
              </svg>
            </a>

            <span id="likes_num-<TMPL_VAR file_id>" class="text-gray-300 text-xs font-medium">
              <TMPL_VAR likes>
            </span>
          </div>
          <div class="inline-flex items-center space-x-2 bg-gray-800 px-3 py-2 rounded-md">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 fill-indigo-400" viewBox="0 0 512 512">
              <path
                d="M512 240c0 114.9-114.6 208-256 208c-37.1 0-72.3-6.4-104.1-17.9c-11.9 8.7-31.3 20.6-54.3 30.6C73.6 471.1 44.7 480 16 480c-6.5 0-12.3-3.9-14.8-9.9c-2.5-6-1.1-12.8 3.4-17.4l0 0 0 0 0 0 0 0 .3-.3c.3-.3 .7-.7 1.3-1.4c1.1-1.2 2.8-3.1 4.9-5.7c4.1-5 9.6-12.4 15.2-21.6c10-16.6 19.5-38.4 21.4-62.9C17.7 326.8 0 285.1 0 240C0 125.1 114.6 32 256 32s256 93.1 256 208z" />
            </svg>
            <span class="text-gray-300 text-xs font-medium">
              <TMPL_VAR comments_count>
            </span>
          </div>
        </div>

        <TMPL_IF usr_player_bar>
          <div class="inline-flex items-center space-x-2">
            <div class="inline-flex items-center space-x-2 bg-gray-800 px-3 py-2 rounded-md">
              <span class="text-gray-400 text-xs font-medium">
                <TMPL_VAR vid_audio_bitrate> kbp/s
              </span>
            </div>
            <div class="inline-flex items-center space-x-2 bg-gray-800 px-3 py-2 rounded-md">
              <span class="text-gray-400 text-xs font-medium">
                <TMPL_VAR file_size_mb>
              </span>
            </div>
            <div class="inline-flex items-center space-x-2 bg-gray-800 px-3 py-2 rounded-md">
              <span class="text-gray-400 text-xs font-medium">
                <TMPL_VAR vid_audio_rate> Hz
              </span>
            </div>
          </div>
        </TMPL_IF>
      </div>
    </div>
  </div>
</div>


<TMPL_IF msg_audio>
  <div class="mt-2 mb-1 relative md:h-28 lg:h-28">
    <div class="relative overflow-hidden rounded-lg bg-gray-700/10 px-4 pb-3 pt-5 sm:px-6 sm:pt-6 mt-6">

      <a href="#"
        class="absolute top-0 right-0 mt-2 mr-2 inline-flex items-center rounded-md bg-white/10 px-3 py-2 text-xs font-semibold text-white shadow-sm hover:bg-white/20">Abort</a>
      <dt>
        <div class="absolute rounded-full bg-gray-800 w-12 h-12 flex justify-center items-center">
          <span class="text-sm font-semibold text-white" id='percent'>0%</span>
        </div>
        <p class="ml-16 truncate text-lg font-semibold text-gray-200">
          Audio is processing now</span>
        </p>
      </dt>
      <dd class="ml-16 flex items-baseline pb-2 sm:pb-2">
        <p class="text-md font-semibold text-gray-400">
          Pending in queue #1
          <span class="text-xs text-gray-500 font-medium">115: <em>seconds left</em></span>
        </p>
      </dd>
    </div>
  </div>
</TMPL_IF>


<style>
  #waveform-<TMPL_VAR file_id> {
    position: relative;
    cursor: pointer;
    z-index: 1;
  }

  #progressBar-<TMPL_VAR file_id> {
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;
    background-color: #c084fc;
    z-index: -1;
  }
</style>


<script>
  document.addEventListener('DOMContentLoaded', () => {
    const audio = document.getElementById('<TMPL_VAR file_id>');
    // Set the source of the audio
    audio.src = '<TMPL_VAR audio_direct_link>';
    // Set the source of the cover image
    const coverImage = document.getElementById('cover-<TMPL_VAR file_id>');
    coverImage.src = '<TMPL_VAR video_thumb_url>';
    // Set the source of the waveform image
    const waveformImage = document.getElementById('wave-<TMPL_VAR file_id>');
    waveformImage.src = '<TMPL_VAR wave1_url>';
    const playPauseBtn = document.getElementById('play-<TMPL_VAR file_id>');
    const currentTimeElement = document.querySelector('.current-time-<TMPL_VAR file_id>');
    const dividerElement = document.querySelector('.divider-<TMPL_VAR file_id>');
    const waveform = document.getElementById('waveform-<TMPL_VAR file_id>');
    const progressBar = document.getElementById('progressBar-<TMPL_VAR file_id>');

    const playIcon = `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class=""> <path stroke-linecap="round" stroke-linejoin="round" d="M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.348a1.125 1.125 0 010 1.971l-11.54 6.347a1.125 1.125 0 01-1.667-.985V5.653z" /> </svg>`;
    const pauseIcon = `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class=""> <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 5.25v13.5m-7.5-13.5v13.5" /> </svg>`;

    var fileId = '<TMPL_VAR file_id>';
    playPauseBtn.addEventListener('click', () => {
      if (audio.paused) {
        audio.play();
        playPauseBtn.innerHTML = pauseIcon;
        // Show the current-time and divider when playing
        currentTimeElement.classList.remove('hidden');
        dividerElement.classList.remove('hidden');
        doPlay(fileId); // Call doPlay function when audio starts
      } else {
        audio.pause();
        playPauseBtn.innerHTML = playIcon;
      }
    });

    waveform.addEventListener('click', (e) => {
      const clickX = e.offsetX;
      const waveformWidth = waveform.clientWidth;
      const duration = audio.duration;
      audio.currentTime = (clickX / waveformWidth) * duration;
    });

    audio.addEventListener('timeupdate', () => {
      const currentTime = audio.currentTime;
      const duration = audio.duration;
      const progressBarWidth = (currentTime / duration) * waveform.clientWidth;
      progressBar.style.width = progressBarWidth + 'px';
      // Update the current time display
      const currentTimeElement = document.querySelector('.current-time-<TMPL_VAR file_id>');
      currentTimeElement.textContent = formatTime(currentTime);
    });

    // Helper function to format time in MM:SS
    function formatTime(seconds) {
      const minutes = Math.floor(seconds / 60);
      const secondsPart = Math.floor(seconds % 60);
      return padWithZero(minutes) + ':' + padWithZero(secondsPart);
    }

    // Helper function to pad time components with zero if needed
    function padWithZero(number) {
      return number < 10 ? '0' + number : number;
    }

    function doPlay(fileId) {
      $.get('<TMPL_VAR site_url>/dl?op=view&file_code=<TMPL_VAR file_code>&hash=<TMPL_VAR ophash>&embed=<TMPL_VAR embed>', function (data) {
        $('#fviews-' + fileId).html(data); // Use fileId to target specific element
      });
    }
  });

</script>